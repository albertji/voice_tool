{"version":3,"sources":["webpack://WaveSurfer.[name]/webpack/universalModuleDefinition","webpack://WaveSurfer.[name]/webpack/bootstrap","webpack://WaveSurfer.[name]/./src/plugin/spectrogram.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","FFT","bufferSize","sampleRate","windowFunc","alpha","this","bandwidth","sinTable","Float32Array","cosTable","windowValues","reverseTable","Uint32Array","peakBand","peak","Math","abs","cos","PI","pow","E","undefined","sin","Error","limit","bit","calculateSpectrum","buffer","rval","ival","mag","real","imag","bSi","sqrt","spectrum","k","floor","log","LN2","length","phaseShiftStepReal","phaseShiftStepImag","currentPhaseShiftReal","currentPhaseShiftImag","off","tr","ti","tmpReal","halfSize","fftStep","N","SpectrogramPlugin","params","ws","_this","_classCallCheck","wavesurfer","util","frequenciesDataUrl","_onScroll","e","updateScroll","_onReady","drawer","container","document","querySelector","width","pixelRatio","fftSamples","height","noverlap","createWrapper","createCanvas","render","wrapper","addEventListener","on","deferInit","staticProps","instance","isReady","unAll","un","removeEventListener","parentNode","removeChild","_this2","prevSpectrogram","wsParams","createElement","labels","labelsEl","classList","add","style","left","position","zIndex","concat","appendChild","loadLabels","display","userSelect","webkitUserSelect","fillParent","scrollParent","overflowX","overflowY","preventDefault","relX","offsetX","layerX","fireEvent","scrollWidth","canvas","spectrCc","getContext","updateCanvasStyle","loadFrequenciesData","getFrequencies","drawSpectrogram","round","frequenciesData","my","backend","getDuration","j","pixels","resample","heightFactor","numberOfChannels","colorValue","fillStyle","fillRect","callback","channelOne","getChannelData","bufferLength","frequencies","uniqueSamplesPerPx","max","fft","currentOffset","segment","slice","array","Uint8Array","log10","push","url","_this3","ajax","data","JSON","parse","target","statusText","freq","toFixed","bgFill","fontSizeFreq","fontSizeUnit","fontType","textColorFreq","textColorUnit","textAlign","getMaxY","labelIndex","step","ac","ctx","fill","textBaseline","label","freqType","units","unitType","font","fillText","x","scrollLeft","oldMatrix","columnsNumber","newMatrix","oldPiece","newPiece","column","Array","oldStart","oldEnd","newStart","newEnd","overlap","min","intColumn"],"mappings":"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","file":"wavesurfer.spectrogram.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"spectrogram\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"spectrogram\"] = factory();\n\telse\n\t\troot[\"WaveSurfer\"] = root[\"WaveSurfer\"] || {}, root[\"WaveSurfer\"][\"spectrogram\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"localhost:8080/dist/plugin/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","/**\r\n * Calculate FFT - Based on https://github.com/corbanbrook/dsp.js\r\n */\r\n/* eslint-disable complexity, no-redeclare, no-var, one-var */\r\nconst FFT = function(bufferSize, sampleRate, windowFunc, alpha) {\r\n    this.bufferSize = bufferSize;\r\n    this.sampleRate = sampleRate;\r\n    this.bandwidth = (2 / bufferSize) * (sampleRate / 2);\r\n\r\n    this.sinTable = new Float32Array(bufferSize);\r\n    this.cosTable = new Float32Array(bufferSize);\r\n    this.windowValues = new Float32Array(bufferSize);\r\n    this.reverseTable = new Uint32Array(bufferSize);\r\n\r\n    this.peakBand = 0;\r\n    this.peak = 0;\r\n\r\n    switch (windowFunc) {\r\n        case 'bartlett':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    (2 / (bufferSize - 1)) *\r\n                    ((bufferSize - 1) / 2 - Math.abs(i - (bufferSize - 1) / 2));\r\n            }\r\n            break;\r\n        case 'bartlettHann':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    0.62 -\r\n                    0.48 * Math.abs(i / (bufferSize - 1) - 0.5) -\r\n                    0.38 * Math.cos((Math.PI * 2 * i) / (bufferSize - 1));\r\n            }\r\n            break;\r\n        case 'blackman':\r\n            alpha = alpha || 0.16;\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    (1 - alpha) / 2 -\r\n                    0.5 * Math.cos((Math.PI * 2 * i) / (bufferSize - 1)) +\r\n                    (alpha / 2) *\r\n                        Math.cos((4 * Math.PI * i) / (bufferSize - 1));\r\n            }\r\n            break;\r\n        case 'cosine':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] = Math.cos(\r\n                    (Math.PI * i) / (bufferSize - 1) - Math.PI / 2\r\n                );\r\n            }\r\n            break;\r\n        case 'gauss':\r\n            alpha = alpha || 0.25;\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] = Math.pow(\r\n                    Math.E,\r\n                    -0.5 *\r\n                        Math.pow(\r\n                            (i - (bufferSize - 1) / 2) /\r\n                                ((alpha * (bufferSize - 1)) / 2),\r\n                            2\r\n                        )\r\n                );\r\n            }\r\n            break;\r\n        case 'hamming':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    (0.54 - 0.46) *\r\n                    Math.cos((Math.PI * 2 * i) / (bufferSize - 1));\r\n            }\r\n            break;\r\n        case 'hann':\r\n        case undefined:\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    0.5 * (1 - Math.cos((Math.PI * 2 * i) / (bufferSize - 1)));\r\n            }\r\n            break;\r\n        case 'lanczoz':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    Math.sin(Math.PI * ((2 * i) / (bufferSize - 1) - 1)) /\r\n                    (Math.PI * ((2 * i) / (bufferSize - 1) - 1));\r\n            }\r\n            break;\r\n        case 'rectangular':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] = 1;\r\n            }\r\n            break;\r\n        case 'triangular':\r\n            for (var i = 0; i < bufferSize; i++) {\r\n                this.windowValues[i] =\r\n                    (2 / bufferSize) *\r\n                    (bufferSize / 2 - Math.abs(i - (bufferSize - 1) / 2));\r\n            }\r\n            break;\r\n        default:\r\n            throw Error(\"No such window function '\" + windowFunc + \"'\");\r\n    }\r\n\r\n    var limit = 1;\r\n    var bit = bufferSize >> 1;\r\n\r\n    var i;\r\n\r\n    while (limit < bufferSize) {\r\n        for (i = 0; i < limit; i++) {\r\n            this.reverseTable[i + limit] = this.reverseTable[i] + bit;\r\n        }\r\n\r\n        limit = limit << 1;\r\n        bit = bit >> 1;\r\n    }\r\n\r\n    for (i = 0; i < bufferSize; i++) {\r\n        this.sinTable[i] = Math.sin(-Math.PI / i);\r\n        this.cosTable[i] = Math.cos(-Math.PI / i);\r\n    }\r\n\r\n    this.calculateSpectrum = function(buffer) {\r\n        // Locally scope variables for speed up\r\n        var bufferSize = this.bufferSize,\r\n            cosTable = this.cosTable,\r\n            sinTable = this.sinTable,\r\n            reverseTable = this.reverseTable,\r\n            real = new Float32Array(bufferSize),\r\n            imag = new Float32Array(bufferSize),\r\n            bSi = 2 / this.bufferSize,\r\n            sqrt = Math.sqrt,\r\n            rval,\r\n            ival,\r\n            mag,\r\n            spectrum = new Float32Array(bufferSize / 2);\r\n\r\n        var k = Math.floor(Math.log(bufferSize) / Math.LN2);\r\n\r\n        if (Math.pow(2, k) !== bufferSize) {\r\n            throw 'Invalid buffer size, must be a power of 2.';\r\n        }\r\n        if (bufferSize !== buffer.length) {\r\n            throw 'Supplied buffer is not the same size as defined FFT. FFT Size: ' +\r\n                bufferSize +\r\n                ' Buffer Size: ' +\r\n                buffer.length;\r\n        }\r\n\r\n        var halfSize = 1,\r\n            phaseShiftStepReal,\r\n            phaseShiftStepImag,\r\n            currentPhaseShiftReal,\r\n            currentPhaseShiftImag,\r\n            off,\r\n            tr,\r\n            ti,\r\n            tmpReal;\r\n\r\n        for (var i = 0; i < bufferSize; i++) {\r\n            real[i] =\r\n                buffer[reverseTable[i]] * this.windowValues[reverseTable[i]];\r\n            imag[i] = 0;\r\n        }\r\n\r\n        while (halfSize < bufferSize) {\r\n            phaseShiftStepReal = cosTable[halfSize];\r\n            phaseShiftStepImag = sinTable[halfSize];\r\n\r\n            currentPhaseShiftReal = 1;\r\n            currentPhaseShiftImag = 0;\r\n\r\n            for (var fftStep = 0; fftStep < halfSize; fftStep++) {\r\n                var i = fftStep;\r\n\r\n                while (i < bufferSize) {\r\n                    off = i + halfSize;\r\n                    tr =\r\n                        currentPhaseShiftReal * real[off] -\r\n                        currentPhaseShiftImag * imag[off];\r\n                    ti =\r\n                        currentPhaseShiftReal * imag[off] +\r\n                        currentPhaseShiftImag * real[off];\r\n\r\n                    real[off] = real[i] - tr;\r\n                    imag[off] = imag[i] - ti;\r\n                    real[i] += tr;\r\n                    imag[i] += ti;\r\n\r\n                    i += halfSize << 1;\r\n                }\r\n\r\n                tmpReal = currentPhaseShiftReal;\r\n                currentPhaseShiftReal =\r\n                    tmpReal * phaseShiftStepReal -\r\n                    currentPhaseShiftImag * phaseShiftStepImag;\r\n                currentPhaseShiftImag =\r\n                    tmpReal * phaseShiftStepImag +\r\n                    currentPhaseShiftImag * phaseShiftStepReal;\r\n            }\r\n\r\n            halfSize = halfSize << 1;\r\n        }\r\n\r\n        for (var i = 0, N = bufferSize / 2; i < N; i++) {\r\n            rval = real[i];\r\n            ival = imag[i];\r\n            mag = bSi * sqrt(rval * rval + ival * ival);\r\n\r\n            if (mag > this.peak) {\r\n                this.peakBand = i;\r\n                this.peak = mag;\r\n            }\r\n            spectrum[i] = mag;\r\n        }\r\n        return spectrum;\r\n    };\r\n};\r\n/* eslint-enable complexity, no-redeclare, no-var, one-var */\r\n\r\n/**\r\n * @typedef {Object} SpectrogramPluginParams\r\n * @property {string|HTMLElement} container Selector of element or element in\r\n * which to render\r\n * @property {number} fftSamples=512 number of samples to fetch to FFT. Must be\r\n * a pwer of 2.\r\n * @property {number} noverlap Size of the overlapping window. Must be <\r\n * fftSamples. Auto deduced from canvas size by default.\r\n * @property {string} windowFunc='hann' The window function to be used. One of\r\n * these: `'bartlett'`, `'bartlettHann'`, `'blackman'`, `'cosine'`, `'gauss'`,\r\n * `'hamming'`, `'hann'`, `'lanczoz'`, `'rectangular'`, `'triangular'`\r\n * @property {?number} alpha Some window functions have this extra value.\r\n * (Between 0 and 1)\r\n * @property {number} pixelRatio=wavesurfer.params.pixelRatio to control the\r\n * size of the spectrogram in relation with its canvas. 1 = Draw on the whole\r\n * canvas. 2 = Draw on a quarter (1/2 the length and 1/2 the width)\r\n * @property {?boolean} deferInit Set to true to manually call\r\n * `initPlugin('spectrogram')`\r\n */\r\n\r\n/**\r\n * Render a spectrogram visualisation of the audio.\r\n *\r\n * @implements {PluginClass}\r\n * @extends {Observer}\r\n * @example\r\n * // es6\r\n * import SpectrogramPlugin from 'wavesurfer.spectrogram.js';\r\n *\r\n * // commonjs\r\n * var SpectrogramPlugin = require('wavesurfer.spectrogram.js');\r\n *\r\n * // if you are using <script> tags\r\n * var SpectrogramPlugin = window.WaveSurfer.spectrogram;\r\n *\r\n * // ... initialising wavesurfer with the plugin\r\n * var wavesurfer = WaveSurfer.create({\r\n *   // wavesurfer options ...\r\n *   plugins: [\r\n *     SpectrogramPlugin.create({\r\n *       // plugin options ...\r\n *     })\r\n *   ]\r\n * });\r\n */\r\nexport default class SpectrogramPlugin {\r\n    /**\r\n     * Spectrogram plugin definition factory\r\n     *\r\n     * This function must be used to create a plugin definition which can be\r\n     * used by wavesurfer to correctly instantiate the plugin.\r\n     *\r\n     * @param  {SpectrogramPluginParams} params parameters use to initialise the plugin\r\n     * @return {PluginDefinition} an object representing the plugin\r\n     */\r\n    static create(params) {\r\n        return {\r\n            name: 'spectrogram',\r\n            deferInit: params && params.deferInit ? params.deferInit : false,\r\n            params: params,\r\n            staticProps: {\r\n                FFT: FFT\r\n            },\r\n            instance: SpectrogramPlugin\r\n        };\r\n    }\r\n\r\n    constructor(params, ws) {\r\n        this.params = params;\r\n        this.wavesurfer = ws;\r\n        this.util = ws.util;\r\n\r\n        this.frequenciesDataUrl = params.frequenciesDataUrl;\r\n        this._onScroll = e => {\r\n            this.updateScroll(e);\r\n        };\r\n        this._onReady = () => {\r\n            const drawer = (this.drawer = ws.drawer);\r\n\r\n            this.container =\r\n                'string' == typeof params.container\r\n                    ? document.querySelector(params.container)\r\n                    : params.container;\r\n\r\n            if (!this.container) {\r\n                throw Error('No container for WaveSurfer spectrogram');\r\n            }\r\n\r\n            this.width = drawer.width;\r\n            this.pixelRatio = this.params.pixelRatio || ws.params.pixelRatio;\r\n            this.fftSamples =\r\n                this.params.fftSamples || ws.params.fftSamples || 512;\r\n            this.height = this.fftSamples / 2;\r\n            this.noverlap = params.noverlap;\r\n            this.windowFunc = params.windowFunc;\r\n            this.alpha = params.alpha;\r\n\r\n            this.createWrapper();\r\n            this.createCanvas();\r\n            this.render();\r\n\r\n            drawer.wrapper.addEventListener('scroll', this._onScroll);\r\n            ws.on('redraw', () => this.render());\r\n        };\r\n    }\r\n\r\n    init() {\r\n        // Check if ws is ready\r\n        if (this.wavesurfer.isReady) {\r\n            this._onReady();\r\n        }\r\n\r\n        this.wavesurfer.on('ready', this._onReady);\r\n    }\r\n\r\n    destroy() {\r\n        this.unAll();\r\n        this.wavesurfer.un('ready', this._onReady);\r\n        this.drawer.wrapper.removeEventListener('scroll', this._onScroll);\r\n        this.wavesurfer = null;\r\n        this.util = null;\r\n        this.params = null;\r\n        if (this.wrapper) {\r\n            this.wrapper.parentNode.removeChild(this.wrapper);\r\n            this.wrapper = null;\r\n        }\r\n    }\r\n\r\n    createWrapper() {\r\n        const prevSpectrogram = this.container.querySelector('spectrogram');\r\n        if (prevSpectrogram) {\r\n            this.container.removeChild(prevSpectrogram);\r\n        }\r\n        const wsParams = this.wavesurfer.params;\r\n        this.wrapper = document.createElement('spectrogram');\r\n        // if labels are active\r\n        if (this.params.labels) {\r\n            const labelsEl = (this.labelsEl = document.createElement('canvas'));\r\n            labelsEl.classList.add('spec-labels');\r\n            this.drawer.style(labelsEl, {\r\n                left: 0,\r\n                position: 'absolute',\r\n                zIndex: 9,\r\n                height: `${this.height / this.pixelRatio}px`,\r\n                width: `${55 / this.pixelRatio}px`\r\n            });\r\n            this.wrapper.appendChild(labelsEl);\r\n            // can be customized in next version\r\n            this.loadLabels(\r\n                'rgba(68,68,68,0.5)',\r\n                '12px',\r\n                '10px',\r\n                '',\r\n                '#fff',\r\n                '#f7f7f7',\r\n                'center',\r\n                '#specLabels'\r\n            );\r\n        }\r\n\r\n        this.drawer.style(this.wrapper, {\r\n            display: 'block',\r\n            position: 'relative',\r\n            userSelect: 'none',\r\n            webkitUserSelect: 'none',\r\n            height: `${this.height / this.pixelRatio}px`\r\n        });\r\n\r\n        if (wsParams.fillParent || wsParams.scrollParent) {\r\n            this.drawer.style(this.wrapper, {\r\n                width: '100%',\r\n                overflowX: 'hidden',\r\n                overflowY: 'hidden'\r\n            });\r\n        }\r\n        this.container.appendChild(this.wrapper);\r\n\r\n        this.wrapper.addEventListener('click', e => {\r\n            e.preventDefault();\r\n            const relX = 'offsetX' in e ? e.offsetX : e.layerX;\r\n            this.fireEvent('click', relX / this.scrollWidth || 0);\r\n        });\r\n    }\r\n\r\n    createCanvas() {\r\n        const canvas = (this.canvas = this.wrapper.appendChild(\r\n            document.createElement('canvas')\r\n        ));\r\n\r\n        this.spectrCc = canvas.getContext('2d');\r\n\r\n        this.util.style(canvas, {\r\n            position: 'absolute',\r\n            zIndex: 4\r\n        });\r\n    }\r\n\r\n    render() {\r\n        this.updateCanvasStyle();\r\n\r\n        if (this.frequenciesDataUrl) {\r\n            this.loadFrequenciesData(this.frequenciesDataUrl);\r\n        } else {\r\n            this.getFrequencies(this.drawSpectrogram);\r\n        }\r\n    }\r\n\r\n    updateCanvasStyle() {\r\n        const width = Math.round(this.width / this.pixelRatio) + 'px';\r\n        this.canvas.width = this.width;\r\n        this.canvas.height = this.height;\r\n        this.canvas.style.width = width;\r\n    }\r\n\r\n    drawSpectrogram(frequenciesData, my) {\r\n        const spectrCc = my.spectrCc;\r\n        const length = my.wavesurfer.backend.getDuration();\r\n        const height = my.height;\r\n        const pixels = my.resample(frequenciesData);\r\n        const heightFactor = my.buffer ? 2 / my.buffer.numberOfChannels : 1;\r\n        let i;\r\n        let j;\r\n\r\n        for (i = 0; i < pixels.length; i++) {\r\n            for (j = 0; j < pixels[i].length; j++) {\r\n                const colorValue = 255 - pixels[i][j];\r\n                my.spectrCc.fillStyle =\r\n                    'rgb(' +\r\n                    colorValue +\r\n                    ', ' +\r\n                    colorValue +\r\n                    ', ' +\r\n                    colorValue +\r\n                    ')';\r\n                my.spectrCc.fillRect(\r\n                    i,\r\n                    height - j * heightFactor,\r\n                    1,\r\n                    heightFactor\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    getFrequencies(callback) {\r\n        const fftSamples = this.fftSamples;\r\n        const buffer = (this.buffer = this.wavesurfer.backend.buffer);\r\n        const channelOne = buffer.getChannelData(0);\r\n        const bufferLength = buffer.length;\r\n        const sampleRate = buffer.sampleRate;\r\n        const frequencies = [];\r\n\r\n        if (!buffer) {\r\n            this.fireEvent('error', 'Web Audio buffer is not available');\r\n            return;\r\n        }\r\n\r\n        let noverlap = this.noverlap;\r\n        if (!noverlap) {\r\n            const uniqueSamplesPerPx = buffer.length / this.canvas.width;\r\n            noverlap = Math.max(0, Math.round(fftSamples - uniqueSamplesPerPx));\r\n        }\r\n\r\n        const fft = new FFT(\r\n            fftSamples,\r\n            sampleRate,\r\n            this.windowFunc,\r\n            this.alpha\r\n        );\r\n        const maxSlicesCount = Math.floor(\r\n            bufferLength / (fftSamples - noverlap)\r\n        );\r\n        let currentOffset = 0;\r\n\r\n        while (currentOffset + fftSamples < channelOne.length) {\r\n            const segment = channelOne.slice(\r\n                currentOffset,\r\n                currentOffset + fftSamples\r\n            );\r\n            const spectrum = fft.calculateSpectrum(segment);\r\n            const array = new Uint8Array(fftSamples / 2);\r\n            let j;\r\n            for (j = 0; j < fftSamples / 2; j++) {\r\n                array[j] = Math.max(-255, Math.log10(spectrum[j]) * 45);\r\n            }\r\n            frequencies.push(array);\r\n            currentOffset += fftSamples - noverlap;\r\n        }\r\n        callback(frequencies, this);\r\n    }\r\n\r\n    loadFrequenciesData(url) {\r\n        const ajax = this.util.ajax({ url: url });\r\n\r\n        ajax.on('success', data =>\r\n            this.drawSpectrogram(JSON.parse(data), this)\r\n        );\r\n        ajax.on('error', e =>\r\n            this.fireEvent('error', 'XHR error: ' + e.target.statusText)\r\n        );\r\n\r\n        return ajax;\r\n    }\r\n\r\n    freqType(freq) {\r\n        return freq >= 1000 ? (freq / 1000).toFixed(1) : Math.round(freq);\r\n    }\r\n\r\n    unitType(freq) {\r\n        return freq >= 1000 ? 'KHz' : 'Hz';\r\n    }\r\n\r\n    loadLabels(\r\n        bgFill,\r\n        fontSizeFreq,\r\n        fontSizeUnit,\r\n        fontType,\r\n        textColorFreq,\r\n        textColorUnit,\r\n        textAlign,\r\n        container\r\n    ) {\r\n        const frequenciesHeight = this.height;\r\n        bgFill = bgFill || 'rgba(68,68,68,0)';\r\n        fontSizeFreq = fontSizeFreq || '12px';\r\n        fontSizeUnit = fontSizeUnit || '10px';\r\n        fontType = fontType || 'Helvetica';\r\n        textColorFreq = textColorFreq || '#fff';\r\n        textColorUnit = textColorUnit || '#fff';\r\n        textAlign = textAlign || 'center';\r\n        container = container || '#specLabels';\r\n        const getMaxY = frequenciesHeight || 512;\r\n        const labelIndex = 5 * (getMaxY / 256);\r\n        const freqStart = 0;\r\n        const step =\r\n            (this.wavesurfer.backend.ac.sampleRate / 2 - freqStart) /\r\n            labelIndex;\r\n\r\n        const ctx = this.labelsEl.getContext('2d');\r\n        this.labelsEl.height = this.height;\r\n        this.labelsEl.width = 55;\r\n\r\n        ctx.fillStyle = bgFill;\r\n        ctx.fillRect(0, 0, 55, getMaxY);\r\n        ctx.fill();\r\n        let i;\r\n\r\n        for (i = 0; i <= labelIndex; i++) {\r\n            ctx.textAlign = textAlign;\r\n            ctx.textBaseline = 'middle';\r\n\r\n            const freq = freqStart + step * i;\r\n            const index = Math.round(\r\n                (freq / (this.sampleRate / 2)) * this.fftSamples\r\n            );\r\n            const label = this.freqType(freq);\r\n            const units = this.unitType(freq);\r\n            const x = 16;\r\n            const yLabelOffset = 2;\r\n\r\n            if (i == 0) {\r\n                ctx.fillStyle = textColorUnit;\r\n                ctx.font = fontSizeUnit + ' ' + fontType;\r\n                ctx.fillText(units, x + 24, getMaxY + i - 10);\r\n                ctx.fillStyle = textColorFreq;\r\n                ctx.font = fontSizeFreq + ' ' + fontType;\r\n                ctx.fillText(label, x, getMaxY + i - 10);\r\n            } else {\r\n                ctx.fillStyle = textColorUnit;\r\n                ctx.font = fontSizeUnit + ' ' + fontType;\r\n                ctx.fillText(units, x + 24, getMaxY - i * 50 + yLabelOffset);\r\n                ctx.fillStyle = textColorFreq;\r\n                ctx.font = fontSizeFreq + ' ' + fontType;\r\n                ctx.fillText(label, x, getMaxY - i * 50 + yLabelOffset);\r\n            }\r\n        }\r\n    }\r\n\r\n    updateScroll(e) {\r\n        if (this.wrapper) {\r\n            this.wrapper.scrollLeft = e.target.scrollLeft;\r\n        }\r\n    }\r\n\r\n    resample(oldMatrix) {\r\n        const columnsNumber = this.width;\r\n        const newMatrix = [];\r\n\r\n        const oldPiece = 1 / oldMatrix.length;\r\n        const newPiece = 1 / columnsNumber;\r\n        let i;\r\n\r\n        for (i = 0; i < columnsNumber; i++) {\r\n            const column = new Array(oldMatrix[0].length);\r\n            let j;\r\n\r\n            for (j = 0; j < oldMatrix.length; j++) {\r\n                const oldStart = j * oldPiece;\r\n                const oldEnd = oldStart + oldPiece;\r\n                const newStart = i * newPiece;\r\n                const newEnd = newStart + newPiece;\r\n\r\n                const overlap =\r\n                    oldEnd <= newStart || newEnd <= oldStart\r\n                        ? 0\r\n                        : Math.min(\r\n                              Math.max(oldEnd, newStart),\r\n                              Math.max(newEnd, oldStart)\r\n                          ) -\r\n                          Math.max(\r\n                              Math.min(oldEnd, newStart),\r\n                              Math.min(newEnd, oldStart)\r\n                          );\r\n                let k;\r\n                /* eslint-disable max-depth */\r\n                if (overlap > 0) {\r\n                    for (k = 0; k < oldMatrix[0].length; k++) {\r\n                        if (column[k] == null) {\r\n                            column[k] = 0;\r\n                        }\r\n                        column[k] += (overlap / newPiece) * oldMatrix[j][k];\r\n                    }\r\n                }\r\n                /* eslint-enable max-depth */\r\n            }\r\n\r\n            const intColumn = new Uint8Array(oldMatrix[0].length);\r\n            let m;\r\n\r\n            for (m = 0; m < oldMatrix[0].length; m++) {\r\n                intColumn[m] = column[m];\r\n            }\r\n\r\n            newMatrix.push(intColumn);\r\n        }\r\n\r\n        return newMatrix;\r\n    }\r\n}\r\n"],"sourceRoot":""}